<!-- /****************** ITC5202 â€“ Project 2 **********
* I declare that this assignment is my own work in accordance with Humber Academic Policy.
* No part of this assignment has been copied manually or electronically from any other source
* (including web sites) or distributed to other students.
*
* Name:  Xinfu Guo   Student ID:   n01611988      Date:   2024/4/14
*
******************************************************************************** -->
<!DOCTYPE html>

<html lang="en">



<head>

 <meta charset="UTF-8" />

 <meta name="viewport" content="width=device-width, initial-scale=1.0" />

 <!-- Task 9 -->
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

 <!-- Tasl 11 -->
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

 <title>5202 Project 2</title>

 <style type="text/css">

  #loader {

   border: 16px solid lightgray;

   /* update this with custom colors */

   border-top: 16px solid peachpuff;

   border-bottom: 16px solid peachpuff;

   border-radius: 50%;

   width: 30px;

   height: 30px;

   animation: spin 2s linear infinite;

   margin: 2em auto;

  }



  @keyframes spin {

   0% {

    transform: rotate(0deg);

   }



   100% {

    transform: rotate(360deg);

   }

  }



  #backButton {

   margin: 2em 0;

  }



  footer {

   text-align: center;

  }

 </style>

</head>



<body >

 <div class="container">



  <h1 id="title">

   <!-- your code will update this h1 with the appropriate title based on the content-->

  </h1>

  <div id="main">

   <!-- your code will update this div with content-->

  </div>

  <nav id="navigation" class="nav">

   <!-- your code will update the disabled attribute with the appropriate value based on the content-->

   <button id="backButton" class="btn btn-primary" type="button" disabled>Back</button>

  </nav>

  <footer>&copy;Xinfu Guo, N01611988, 2024</footer>

 </div>





 <script>

  // call this to show the loading indicator while fetching data

  function showLoader() {

   document.getElementById("main").innerHTML = '<div id="loader"></div>';

  }



  // call this to remove the loading indicator

  function hideLoader() {

   document.getElementById("main").innerHTML = "";

  }



  // call this to update the main header title. The title should reflect the type of content you are displaying

  function updateTitle(title) {

   document.getElementById("title").innerHTML = title;

  }



  //Task 5 
  function initBackButton() {

   document.getElementById("backButton").onclick = async () => {

    try {
    const users = await fetchUsers();
    renderUserTable(users);

    updateTitle("User");
    enableBack(false);
   } 
   catch (error) {
    console.error(error);
   }

   };

  }



  // call this to enable the back button when you are in a Posts or Todos page. e.g. enableBack(true)

  // call this to disable the back button when you are on the Users page. e.g. enableBack(false)

  function enableBack(enabled) {

   document.getElementById("backButton").disabled = !enabled;

  }



  //Task 1
  window.addEventListener("load", async () => {


   initBackButton();

    //Task 4
    // add your code to fetch users here.
   try {
    const users = await fetchUsers();
    renderUserTable(users);
    updateTitle("User");
   } 
   catch (error) {
    console.error(error);
   }







  

   // something like (this is just an EXAMPLE. you can do it how you think it best):

   // const myUsers = await myFetchUsersFunction();

   // renderUserTable(myUsers);

   // updateTitle('Users');

  });


 //Tast 2
 async function fetchUsers(){
    try {
      showLoader();//Task 8
      updateTitle("User");//Task 8
      const response = await fetch("https://jsonplaceholder.typicode.com/users");

      if(!response.ok){
        throw new Error("Fail to fetch users.", response.statusText);
      }

      const users = await response.json();
      console.log(users);
      return users;

    } catch (error) {
      throw error;
      hideLoader();//Tast 8
    }
  }
  

  //Task 3 + Task 5(btnPost) + Task 6(btnTodos)
  function renderUserTable(users){
    try {
      let html = `<table class="table table-striped">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>UserName</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Company</th>
        </tr>
      </thead>
      <tbody>`;

      users.forEach(user => {
        html += `
        <tr>
            <td>${user.id}</td>
            <td>${user.name}</td>
            <td>${user.username}</td>
            <td>${user.email}</td>
            <td>${user.phone}</td>
            <td>${user.company.name}</td>
            <td><button onClick="showPostsForUser(${user.id})">Posts</button></td>
            <td><button class="btn btn-primary" onClick="showTodosForUser(${user.id})">todos</button></td>
        </tr>`;
      });
      html += `</tbody></table>`;
      document.getElementById("main").innerHTML = html;
      
    }catch (error) {
      throw error;
    }
  }


  //Task 5
  async function showPostsForUser(userId){
    showLoader();//Tast 8
    updateTitle("Posts");//Tast 8
    try {
      const response = await fetch(`https://jsonplaceholder.typicode.com/users/${userId}/posts`);
      if(!response.ok){
        throw new Error("Fail to fetch users.", response.statusText);
      }

      const posts = await response.json();

      if(posts.length === 0){
        throw new Error("No available posts for this users");
      }

      console.log(posts);

      let html = `
        <table class="table table-hover">
          <thead>
            <tr>
              <th>ID</th>
              <th>UserID</th>
              <th>Title</th>
            </tr>
          </thead>
          <tbody>`;
      posts.forEach(post =>{
        html += `
          <tr>
            <td>${post.id}</td>
            <td>${post.userId}</td>
            <td>${post.title}</td>
          </tr>`;
      })
      html += `</tbody></table>`;

      document.getElementById("main").innerHTML = html;

      enableBack(true);

    } catch (error) {
      console.error(error);
      hideLoader();//Tast 8
    }

  }

  //Task 6
  function showTodosForUser(userId){
    showLoader();//Tast 8
    updateTitle("Todos");//Tast 8
    fetch(`https://jsonplaceholder.typicode.com/users/${userId}/todos`)
    .then(response => {
      if (!response.ok) {
        throw new Error(`Failed to fetch Todos: ${response.statusText}`);
      }
      return response.json();
    })
    .then(todos =>{
      if(todos.length === 0){
        throw new Error("No available todos for this user");
      }
      console.log(todos);


      let html = `
        <select id="filterTodos" onchange="filterTodos()">
          <option value="all">Show All</option>
            <option value="completed">Show Completed</option>
          <option value="incomplete">Show Incompleted</option>
        </select>`;

        //Task 10
      html += `
        <table class="table table-hover">
          <thead>
            <tr class="todoItem">
              <th>ID</th>
              <th>User ID</th>
              <th>Title</th>
              <th>Completed</th>
            </tr>
            </thead>
            <tbody>
        `;
      todos.forEach(todo => {
        html += `
        <tr data-completed="${todo.completed}">
          <td>${todo.id}</td>
          <td>${todo.userId}</td>
          <td>${todo.title}</td>
          <td>${todo.completed ? 'Yes' : 'No'}</td> 
        </tr>`;
      });

      html += '</tbody></table>';

      document.getElementById("main").innerHTML = html;

      //Task9
      $('tr[data-completed="false"]').css({
            'background-color': '#ffc107', 
            'color': '#333', 
            'font-weight': 'bold' 
        });

      enableBack(true);

    })
    .catch(error =>{
      console.error(error);
      hideLoader();//Tast 8
    })


    
  }

  //Task 10
  function filterTodos(){
    var filter = document.getElementById("filterTodos").value;
    var rows = document.querySelectorAll("tr[data-completed]");

    rows.forEach(row => {
        var completed = row.getAttribute("data-completed") === "true"; 

        switch (filter) {
            case "all":
                row.style.display = "";
                break;
            case "completed":
                row.style.display = completed ? "" : "none";
                break;
            case "incomplete":
                row.style.display = !completed ? "" : "none";
                break;
        }
    });
      
    }
 </script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>



</html>